<?xml version="1.0" encoding="UTF-8"?>
<wps:ExecuteResponse xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 ../wpsExecute_response.xsd" service="WPS" version="1.0.0" xml:lang="{{ lang }}" serviceInstance="{{ service_instance }}" statusLocation="{{ status_location }}">
    <wps:Process wps:processVersion="{{ process.version }}">
        <ows:Identifier>{{ process.identifier }}</ows:Identifier>
        <ows:Title>{{ process.title }}</ows:Title>
        <ows:Abstract>{{ process.abstract }}</ows:Abstract>
        {% if profile %}
        <wps:Profile>{{ process.profile }}</wps:Profile>
        {% endif %}
        {% if wsdl %}
        <wps:WSDL xlink:href="{{ process.wsdl }}"/>
        {% endif %}
	</wps:Process>
    <wps:Status creationTime="{{ status.time }}">
        {% if status.status == "accepted" %}
        <wps:ProcessAccepted />
        {% elif status.status == "started" %}
        <wps:ProcessStarted percentCompleted="{{ status.percent_done }}">{{ message }}</wps:ProcessStarted>
        {% elif status.status == "paused" %}
        <wps:ProcessPaused percentCompleted="{{ status.percent_done }}">{{ message }}</wps:ProcessPaused>
        {% elif status.status == "succeeded" %}
        <wps:ProcessSucceeded />
        {% elif status.status == "failed" %}
        <wps:ProcessFailed>
            <wps:ExceptionReport>
                    <ows:Exception exceptionCode="NoApplicableCode" locator="None">
                            <ows:ExceptionText>{{ status.message }}</ows:ExceptionText>
                    </ows:Exception>
            </wps:ExceptionReport>
        </wps:ProcessFailed>
        {% endif %}
	</wps:Status>
    {% if lineage %}
    {% if input_definitions %}
	<wps:DataInputs>
        {% for input in input_definitions %}
		<wps:Input>
            <ows:Identifier>{{ input.identifier }}</ows:Identifier>
            <ows:Title>{{ input.title }}</ows:Title>
            {% if input.type == "complex" %}
			<wps:Data>
                    <wps:ComplexData mimeType="{{ input.mimetype }}" encoding="{{ input.encoding }}" schema="{{ input.schema }}">{{ input.data }}</wps:ComplexData>
			</wps:Data>
            {% elif input.type == "literal" %}
			<wps:Data>
                <wps:LiteralData {% if input.uom %}uom="{{ input.uom.reference }}"{% endif %}>{{ input.value }}</wps:LiteralData>
			</wps:Data>
            {% elif input.type == "bbox" %}
			<wps:Data>
                {% if input.crs == "EPSG:4326" %}
                <ows:WGS84BoundingBox dimensions="{{ output.dimensions }}">
                    <ows:LowerCorner>{% for c in input.ll %} {{ c }} {% endfor %}</ows:LowerCorner>
                    <ows:UpperCorner>{% for c in input.ur %} {{ c }} {% endfor %}</ows:UpperCorner>
                </ows:WGS84BoundingBox>
                {% else %}
                <ows:BoundingBox crs="{{ output.crs }}" dimensions="{{ output.dimensions }}">
                    <ows:LowerCorner>{% for c in input.ll %} {{ c }} {% endfor %}</ows:LowerCorner>
                    <ows:UpperCorner>{% for c in input.ur %} {{ c }} {% endfor %}</ows:UpperCorner>
                </ows:BoundingBox>
                {% endif %}
			</wps:Data>
            {% elif input.type == "reference" %}
            <wps:Reference xlink:href="{{ input.href }}" method="{{ input.method }}" mimeType="{{ input.mimetype }}" encoding="{{ input.encoding }}" schema="{{ input.schema }}"/>
            {% endif %}
		</wps:Input>
        {% endfor %}
	</wps:DataInputs>
    {% endif %}
    {% if output_definitions %}
	<wps:OutputDefinitions>
        {% for output in output_definitions %}
        {% if output.type == "complex" %}
        <wps:Output mimeType="{{ output.mimetype }}" encoding="{{ output.encoding }}" schema="{{ output.schema }}" asReference="{{ output.asreference }}">
        {% else %}
        <wps:Output>
        {% endif %}
            <ows:Identifier>{{ output.identifier }}</ows:Identifier>
            <ows:Title>{{ output.title }}</ows:Title>
            <ows:Abstract>{{ output.abstract }}</ows:Abstract>
		</wps:Output>
        {% endfor %}
	</wps:OutputDefinitions>
    {% endif %}
    {% endif %}
    {% if outputs %}
	<wps:ProcessOutputs>
        {% for output in outputs %}
		<wps:Output>
            <ows:Identifier>{{ output.identifier }}</ows:Identifier>
            <ows:Title>{{ output.title }}</ows:Title>
            <ows:Abstract>{{ output.abstract }}</ows:Abstract>
            {% if output.type == "reference" %}
            <wps:Reference href="{{ output.href }}" mimeType="{{ output.mimetype }}" encoding="{{ output.encoding }}" schema="{{ output.schema }}"/>
            {% elif output.type == "complex" %}
			<wps:Data>
                    <wps:ComplexData mimeType="{{ output.mimetype }}" encoding="{{ output.encoding }}" schema="{{ output.schema }}"><![CDATA[
                            {{ output.data |replace("\\n", "\n") }}
                    ]]></wps:ComplexData>
			</wps:Data>
            {% elif output.type == "literal" %}
			<wps:Data>
                <wps:LiteralData {% if output.uom %}uom="{{ output.uom.reference }}"{% endif %}>{{ output.data }}</wps:LiteralData>
			</wps:Data>
            {% elif output.type == "bbox" %}
			<wps:Data>
                    {% if output.crs == "EPSG:4326" %}
                    <ows:WGS84BoundingBox dimensions="{{ output.dimensions }}">
                        <ows:LowerCorner>{% for c in output.ll %} {{ c }} {% endfor %}</ows:LowerCorner>
                        <ows:UpperCorner>{% for c in output.ur %} {{ c }} {% endfor %}</ows:UpperCorner>
                    </ows:WGS84BoundingBox>
                    {% else %}
                    <ows:BoundingBox crs="{{ output.crs }}" dimensions="{{ output.dimensions }}">
                        <ows:LowerCorner>{% for c in output.ll %} {{ c }} {% endfor %}</ows:LowerCorner>
                        <ows:UpperCorner>{% for c in output.ur %} {{ c }} {% endfor %}</ows:UpperCorner>
                    </ows:BoundingBox>
                    {% endif %}
			</wps:Data>
            {% endif %}
		</wps:Output>
        {% endfor %}
	</wps:ProcessOutputs>
    {% endif %}
</wps:ExecuteResponse>
